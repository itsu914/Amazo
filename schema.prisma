generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            Int       @id @default(autoincrement())
  email         String    @unique
  passwordHash  String
  isAdmin       Boolean   @default(false)
  points        Int       @default(0)
  createdAt     DateTime  @default(now())
  gameEvents    GameEvent[]
  transactions  Transaction[]
  redemptions   Redemption[]
}

model GameEvent {
  id            Int      @id @default(autoincrement())
  user          User     @relation(fields: [userId], references: [id])
  userId        Int
  pointsAwarded Int
  providerPayload String? 
  createdAt     DateTime @default(now())
}

model Transaction {
  id         Int      @id @default(autoincrement())
  user       User     @relation(fields: [userId], references: [id])
  userId     Int
  amount     Int      // positive = credit, negative = debit
  kind       String   // e.g., "game_reward", "redemption"
  ref        String?  // optional reference id
  createdAt  DateTime @default(now())
}

model Redemption {
  id             Int      @id @default(autoincrement())
  user           User     @relation(fields: [userId], references: [id])
  userId         Int
  pointsSpent    Int
  valueCents     Int
  provider       String
  providerTxId   String? 
  code           String? 
  status         String   @default("pending") // pending, sent, failed
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}